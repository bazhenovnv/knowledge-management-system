#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö –∫–µ—à–µ–π

set -e  # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ

echo "üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É —Å –æ—á–∏—Å—Ç–∫–æ–π –∫–µ—à–µ–π..."
echo "=========================================="

# 1. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–π —Å–±–æ—Ä–∫–∏
echo ""
echo "üßπ –®–∞–≥ 1/5: –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä–æ–π —Å–±–æ—Ä–∫–∏..."
rm -rf dist
echo "‚úÖ –ü–∞–ø–∫–∞ dist —É–¥–∞–ª–µ–Ω–∞"

# 2. –û—á–∏—Å—Ç–∫–∞ node_modules –∫–µ—à–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# echo ""
# echo "üßπ –û—á–∏—Å—Ç–∫–∞ node_modules –∫–µ—à–∞..."
# rm -rf node_modules/.vite
# echo "‚úÖ Vite –∫–µ—à –æ—á–∏—â–µ–Ω"

# 3. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
echo ""
echo "üì¶ –®–∞–≥ 2/5: –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞..."
npm run build

if [ ! -d "dist" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ü–∞–ø–∫–∞ dist –Ω–µ —Å–æ–∑–¥–∞–Ω–∞!"
    exit 1
fi
echo "‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω"

# 4. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ nginx –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
echo ""
echo "üóëÔ∏è –®–∞–≥ 3/5: –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ nginx..."
if [ -d "/var/cache/nginx" ]; then
    sudo rm -rf /var/cache/nginx/*
    echo "‚úÖ –ö–µ—à nginx –æ—á–∏—â–µ–Ω"
else
    echo "‚ö†Ô∏è –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è /var/cache/nginx –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º"
fi

# 5. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx
echo ""
echo "‚ôªÔ∏è –®–∞–≥ 4/5: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx..."
if command -v nginx &> /dev/null; then
    sudo nginx -t && sudo systemctl reload nginx
    echo "‚úÖ Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω"
else
    echo "‚ö†Ô∏è Nginx –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É"
fi

# 6. –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
echo ""
echo "=========================================="
echo "‚úÖ –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo "=========================================="
echo ""
echo "üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞: Ctrl+Shift+R (Windows/Linux) –∏–ª–∏ Cmd+Shift+R (Mac)"
echo "2. –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ"
echo ""
echo "üåê –§–∞–π–ª—ã –≥–æ—Ç–æ–≤—ã –≤ –ø–∞–ø–∫–µ: ./dist"
echo ""
